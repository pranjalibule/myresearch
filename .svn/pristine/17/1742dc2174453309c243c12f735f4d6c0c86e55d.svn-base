<!DOCTYPE html>
<html>
<head>
    <title>Task</title>
    <meta charset="utf-8" />
    <script src="/scripts/dateformt.js"></script>
    <script src="/scripts/jquery-3.1.1.min.js"></script>
    <script src="/scripts/common.js"></script>
    <script src="/scripts/jquery-ui.js"></script>
    <link href="/styles/TTM.css" rel="stylesheet" />
    <script>
        if (getUrlVars().length < 2) {
            window.location = "index.html?page=TSRDashboard.html";
        }
        else {
            userId = decodeURI(getUrlVars()["user"]);
        }

        if (CheckUser() == "") {
            window.location = "index.html?page=TSRDashboard.html";
        }

        function NavigateTo(page) {
            window.location = page;
        }
        var tsrId = getUrlVars()["tsrid"];
        var tsoId = getUrlVars()["tsoid"];
        var serviceDeliveryChainId = getUrlVars()["serviceDeliveryChainId"];
        var tsoServiceDeliveryChainId = getUrlVars()["tsoServiceDeliveryChainId"]

        var startDate;
        var targetCompletionDate;

    </script>
    <link rel="stylesheet" href="/styles/jquery-ui.css" />
    <style>
        .highlight {
            background-color: lightblue;
        }

        .ui-autocomplete {
            height: 200px;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .width25imp {
            width: 26% !important;
        }

        /*.field {
            width: 35% !important;
        }*/
    </style>
</head>
<body>
    <div id="WaitCursor" style="display:none" title="TTM"></div>
    <div class="header" style="height:3.5vh; padding-bottom:0px;">
        <div>

        </div>
        <div class="topRightLogo UserLogo">
        </div>
        <div class="topRightLogo ContactUs" onclick="sendEmail();">
        </div>
        <!--<div class="topRightLogo Help" onclick="showHelp();">
        </div>-->
    </div>
    <div class="userInfo">
        <div id="lblUser"></div>
    </div>
    <div class="leftDiv" style="height:820px;padding-top:11px;">
        <table id="tblMain">
            <tr>
                <td class="leftMenuSmallPortal">
                    <a href="#" onclick="Home();">Home</a>
                </td>
            </tr>
            <!--<tr>
                <td class="leftMenuSmallPortal">
                    <a href="#" onclick="CreateNewTSO('');">Create New TSO</a>
                </td>
            </tr>-->

            <tr>
                <td class="leftMenuSmallPortal">
                    <a href="#" onclick="GotoTSRDashboard();">TSR Dashboard</a>
                </td>
            </tr>
            <tr>
                <td class="leftMenuSmallPortal">
                    <a href="#" onclick="GotoTSODashboard('');">TSO Dashboard</a>
                </td>
            </tr>
            <tr id="trNewTSR">
                <td class="leftMenuSmallPortal GuestClass">
                    <a href="#" onclick="CreateNewTSR('');">Create New TSR</a>
                </td>
            </tr>
            <tr>
                <td class="leftMenuSmallPortal GuestClass">
                    <a href="#" onclick="ExportExcelDump('');">Export Data</a>
                </td>
            </tr>
            <tr>
                <td class="leftMenuSmallPortal AdminClass" style="display:none;">
                    <a href="#" onclick="MasterData()">Master Data</a>
                </td>
            </tr>
            <tr>
                <td class="leftMenuSmallPortal">
                    <!--<a href="Wiki.html" target="_blank">Wiki</a>-->
                    <a href='#' onclick="this.href='Wiki.html?user='+ encodeURI(userId)" target="_blank">Wiki</a>
                </td>
            </tr>
            <tr>
                <td class="leftMenuSmallPortal">
                    <a href="index.html">Sign Off</a>
                </td>
            </tr>
        </table>
    </div>
    <div class="rightDiv">
        <div id="breadCrumb">
        </div>
        <div class="scrollDiv">
            <table cellpadding="5" class="tsoPage" id="TaskInfo">
                <tr>
                    <td colspan="2">
                        <fieldset style="width:100%;">
                            <legend style="font-weight:bold">Task Information</legend>
                            <table cellpadding="0" cellspacing="0" class="tsotop">
                                <tr>
                                    <td class="smallTiletd width18imp">
                                        Task
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp">
                                        <!--<div id="lblTask"></div>-->
                                        <input type="hidden" value="" id="txtOid" />
                                        <input id="lblTask" style="width:140px;float:left;" type="text" size="22" maxlength="100" />
                                    </td>

                                    <td class="titletd width18imp">
                                        Method
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width18imp">
                                        <select id="ddlMethod" style="width:140px;float:left;"></select>
                                    </td>
                                </tr>                                
                                <tr>
                                    <td class="titletd width18imp required">
                                        Description
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" colspan="3">
                                        <textarea id="txtNotes" style="width:665px;" rows="5" cols="91" maxlength="500"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="titletd width18imp">
                                        TSO
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp">                                       
                                        <input id="lblTSO" style="width:140px;float:left;" type="text" size="22" maxlength="100" />
                                        <input type="hidden" id="TSOStartDate" />
                                        <input type="hidden" id="TSOTargetCompletionDate" />
                                        <input type="hidden" id="hiddennEstimatedEffort" />
                                        <input type="hidden" id="hiddentsoPlannedEffort" />
                                        <input type="hidden" value="" id="txtTSOServiceDeliveryChainId" />
                                    </td>
                                </tr>
                                <!--<tr>
            <td class="titletd width18imp required">
                Actual Completion Date
            </td>
            <td class="seprator">:</td>
            <td class="width18imp">
                <input id="txtActualCompletionDate" type="text" size="22" maxlength="100" /><br />
            </td>

        </tr>-->

                                <tr style="display:none;">
                                    <td class="titletd width18imp" hidden="hidden">
                                        Project Model
                                    </td>
                                    <td class="seprator" hidden="hidden">:</td>
                                    <td class="width25imp" hidden="hidden">
                                        <div id="lblProjectModel" hidden="hidden"></div>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
                <tr>
                    <td>
                        <fieldset style="width:100%;">
                            <legend style="font-weight:bold">Task Progress</legend> <div style="text-align:justify; fill;float:left;">(Please fill in your respective weekly data below )</div>
                            <table cellpadding="0" cellspacing="0" class="tsotop">
                                <tr>
                                    <td class="titletd width18imp required">
                                        Planned Start Date
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp">
                                        <input id="txtStartDate" style="width:140px;float:left;" type="text" size="22" maxlength="100" /><br />
                                    </td>                                 
                                    <td class="titletd width18imp required">
                                        Planned Completion Date
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width18imp">
                                        <input id="txtTargetCompletionDate" style="width:140px;float:left;" type="text" size="22" maxlength="100" /><br />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="titletd required width18imp">
                                        Week Number
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field width29imp">
                                        <input type="hidden" id="hiddenEffortsEnteredUntil" />
                                        <input id="txtEffortsEnteredUntil" style="width:140px;float:left;" type="text" size="22" maxlength="100" />
                                    </td>

                                    
                                    <td class="titletd width18imp">
                                        Headcount
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field width18imp">
                                        <input id="txtHeadCount" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event, this); IdleEffort()" type="text" size="22" maxlength="100" disabled />
                                        <div class="waterInfo">#FTE</div>
                                    </td> 
                                </tr>

                                <tr>
                                    <td class="titletd width18imp">
                                        Idle Time (Effort)
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field width29imp">
                                        <input id="txtIdleTimeEf"  style="width:140px;float:left;"onkeyup="intNumber(event, this)" ; type="text" size="22" maxlength="100" disabled />
                                        <div class="waterInfo">PD</div>
                                    </td>

                                    <td class="titletd width18imp">
                                        Idle Time (Duration)
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width18imp">
                                        <input id="txtIdleTimeDu" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event, this); IdleEffort()" ; type="text" size="22" maxlength="100" />
                                        <div class="waterInfo">WD</div>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="titletd width18imp">
                                        Task Status
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width18imp">
                                        <select id="ddlTaskStatus" style="width:144px;float:left;" onchange="checkClose(event, this)" onFocus="(this.aOldValue=this.value)"></select>
                                    </td>                               
                                </tr>
                               

                                <tr style="display:none;">
                                    <td class="titletd required width18imp">
                                        Completed
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp">
                                        <!--<!--<input id="txtPercentageComplete" onkeyup="intNumber(event , this);" type="text" size="40" maxlength="3" />-->
                                        <select id="txtPercentageComplete" style="width:175px;">
                                            <option value="N">No</option>
                                            <option value="Y">Yes</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
                <tr class="halfTd">
                    <td>
                        <fieldset id="actualProductivity">
                            <legend style="font-weight:bold">
                                <table cellpadding="0" cellspacing="0" class="tsotop">
                                    <tr style="min-height:20px;margin:0;">
                                        <td style="width:44%;padding:0;">
                                            Productivity KPIs (Actual)
                                        </td>
                                        <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                        <!--<td style="width:20%;padding:0;font-size:medium;font-weight:normal;">Cumulative</td>-->
                                        <td style="width:auto;padding:0;float:right;">
                                            <input type="button" id="ActualReset" title="Use this option only for the first week of task" value="Reset to 0" onclick="ActualReset();" style="float:none;margin:0;padding:2px 10px;" />
                                        </td>                                        
                                    </tr>
                                    <tr><td style="width:10%;padding:0;float:left;font-style:italic;" id="foractualweek"></td></tr>
                                </table>
                            </legend>
                            <table cellpadding="0" cellspacing="0" class="tsotop">
                                <tr>
                                    <td class="halftitletd required"> 
                                        Effort
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <!--<td class="field" style="width:15% !important;text-align:center;" id="lbleffort"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualEffort" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event, this); ActualProductivity(); Headcount();" type="text" size="22" maxlength="100"  /> <!--value="0"-->
                                         <div class="waterInfo">PD</div>
                                    </td>                                   
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Input
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualInput" style="width:140px;" onkeyup="intNumber(event, this); ActualProductivityIB();" type="text" size="22" maxlength="100"  />
                                        <div  class="waterInfo" id="actualA"># of items</div>
                                         <!--<div class="waterInfo" style="display:none;" id="actualA">A: # Requirements/Use cases/User stories etc.</div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="actualD">
                                            D: # Test conditions
                                        </div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="actualI">
                                            I : # Logical test cases
                                        </div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="actualE">
                                            E: # Concrete test cases
                                        </div>-->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Outcome
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <!--<td class="field" style="width:15% !important;text-align:center;" id="lblActualOutcome"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualOutcome" style="width:140px;float:left;" onkeyup="intNumber(event, this); ActualProductivity(); ActualProductivityTB(); ActualProductivityIB(); defectDensity();" type="text" size="22" maxlength="100"  />
                                     <div class="waterInfo"># of items</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd ">
                                        Outcome (Test Steps)
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <!--<td class="field" style="width:15% !important;text-align:center;" id="lblActualOutcomeTestSteps"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualOutcomeTestSteps" style="width:140px;float:left;" onkeyup="intNumber(event, this);" type="text" size="22" maxlength="100"  />
                                     <div class="waterInfo"># of test steps</div>
                                    </td>
                                </tr>  
                                <tr>
                                    <td class="halftitletd required">
                                        Processing Time
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <!--<td class="field" style="width:15% !important;text-align:center;" id="lblActualProcessingTime"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualProcessingTime" style="width:140px;float:left;" onkeyup="intNumber(event, this); ActualProductivityTB(); Headcount();" type="text" size="22" maxlength="100" />
                                    <div class="waterInfo">WD</div>
                                    </td>
                                </tr>
                              
                                <tr>
                                    <td class="halftitletd required">
                                        Productivity
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualProductivityEB" style="width:140px;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/PD</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Throughput
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualProductivityTB" style="width:140px;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/WD</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Outcome ratio
                                    </td>
                                    <!--<td class="field" style="width:15% !important;text-align:center;"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:40% !important;">
                                        <input id="txtActualProductivityIB" style="width:140px;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/Input</div>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                    <td>
                        <fieldset id="plannedProductivity">
                            <legend style="font-weight:bold">
                                <table cellpadding="0" cellspacing="0" class="tsotop">
                                    <tr style="min-height:20px;margin:0;">
                                        <td style="width:44%;padding:0;">
                                            Productivity KPIs (Planned)
                                        </td>                                        
                                        <td style="width:auto;padding:0;float:right;">
                                            <input type="button" id="PlannedReset" title="Use this option only for the last week of task" value="Reset to 0" onclick="PlannedReset();" style="float:none;margin:0;padding:2px 10px;" />
                                        </td>                                       
                                    </tr>
                                    <tr><td style="width:20%;padding:0;float:left;font-style:italic;" id="forplannedweek"></td></tr>
                                </table>
                            </legend>
                            <table cellpadding="0" cellspacing="0" class="tsotop">
                                <tr>
                                    <td class="halftitletd required">
                                        Effort
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedEffort" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event, this); PlannedProductivity();" type="text" size="22" maxlength="100" />
                                        <div class="waterInfo">PD</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Input
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedInput" style="width:140px;float:left;" onkeyup="intNumber(event, this); PlannedProductivityIB();" type="text" size="22" maxlength="100"  />
                                        <div class="waterInfo"  id="plannedA"># of items</div>
                                        <!--<div class="waterInfo" style="display:none;" id="plannedA">A: # Requirements/Use cases/User stories etc.</div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="plannedD">
                                            D: # Test conditions
                                        </div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="plannedI">
                                            I : # Logical test cases
                                        </div>
                                        <div class="waterInfo" style="width:90%; display:none;" id="plannedE">
                                            E: # Concrete test cases
                                        </div>-->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Outcome
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedOutcome" style="width:140px;float:left;" onkeyup="intNumber(event, this); PlannedProductivity(); PlannedProductivityIB(); PlannedProductivityTB();" type="text" size="22" maxlength="100" />
                                        <div class="waterInfo"># of items</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd">
                                        Outcome (Test Steps)
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedOutcomeTestSteps" style="width:140px;float:left;" onkeyup="intNumber(event, this);" type="text" size="22" maxlength="100"  />
                                        <div class="waterInfo"># of test steps</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Processing time
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedProcessingTime" style="width:140px;float:left;" onkeyup="intNumber(event, this); PlannedProductivityTB();" type="text" size="22" maxlength="100" />
                                        <div class="waterInfo">WD</div>
                                    </td>
                                </tr>                               
                                <tr>
                                    <td class="halftitletd required">
                                        Productivity
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedProductivityEB" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/PD</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Throughput
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedProductivityTB" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/WD</div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="halftitletd required">
                                        Outcome ratio
                                    </td>
                                    <td class="seprator">:</td>
                                    <td class="field" style="width:35% !important;">
                                        <input id="txtPlannedProductivityIB" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled value="0" />
                                        <div class="waterInfo"># of outcome/Input</div>
                                    </td>
                                </tr>
                            </table>
                        </fieldset>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <fieldset style="width:100%;">
                            <legend style="font-weight:bold">
                                <table cellpadding="0" cellspacing="0" class="tsotop">
                                    <tr style="min-height:20px;margin:0;">
                                        <td style="width:18%;padding:0;">
                                            Service Quality KPIs
                                        </td>
                                        <!--<td style="width:50%;padding:0;font-size:medium;font-weight:normal;">Cumulative</td>
                                        <td style="width:20%;padding:0;"></td>
                                        <td style="width:20%;padding:0;font-size:medium;font-weight:normal;">Cumulative</td>-->
                                        <td style="width:20%;padding:0;font-size:medium;font-weight:normal;">(Please fill in your respective weekly data below )</td>
                                    </tr>                                    
                                </table>
                            </legend>
                            <table cellpadding="0" cellspacing="0" class="tsotop">
                                <tr>
                                    <td class="titletd width18imp required" style="width:17%!important;">
                                        Planned Review Rounds
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp" style="width:20% !important;">
                                        <input id="txtPlannedServiceQuality" style="width:140px;float:left;" onkeyup="intNumber(event , this);" type="text" size="22" maxlength="100" />
                                    </td>
                                    <td class="titletd width18imp required" style="width:17%!important;">
                                        Actual Review Rounds
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <td class="seprator">:</td>
                                    <td class="width25imp" style="width:20% !important;">
                                        <input id="txtActualServiceQuality" style="width:140px;float:left;" onkeyup="intNumber(event , this);" type="text" size="22" maxlength="100" />
                                        <!--<div class="waterInfo">Person days</div>-->
                                    </td>
                                </tr>
                                <tr>
                                    <td class="titletd width18imp required" style="width:17%!important;">
                                        Defects Raised
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <!--<td class="field" style="width:7.5% !important;text-align:center;" id="lblDefectsRaised"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="width29imp" style="width:20% !important;">
                                        <input id="txtDefectsRaised" style="width:140px;float:left;" onkeyup="intNumber(event, this); defectDensity();" type="text" size="22" maxlength="100" />

                                    </td>
                                    <td class="titletd width18imp required" style="width:17%!important;">
                                        Defects Rejected
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <!--<td class="field" style="width:7.5% !important;text-align:center;" id="lblDefectsRejected"></td>-->
                                    <td class="seprator">:</td>
                                    <td class="width25imp" style="width:20% !important;">
                                        <input id="txtDefectsRejected" style="width:140px;float:left;" onkeyup="intNumber(event, this); defectRatio(); " type="text" size="22" maxlength="100" />

                                    </td>
                                </tr>
                                <tr>
                                    <td class="titletd width18imp" style="width:17%!important;">
                                        Defect Density
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <td class="seprator">:</td>
                                    <td class="width29imp" style="width:20% !important;">
                                        <!--<div id="lblDefectDensity"></div>-->
                                        <input id="txtDefectDensity" style="width:140px;float:left;" onkeyup="NumAndTwoDecimals(event , this);" type="text" size="22" maxlength="100" disabled />
                                    </td>
                                    <td class="titletd width18imp" style="width:17%!important;">
                                        Defect Rejection Ratio
                                    </td>
                                    <td class="field" style="width:7.5% !important;text-align:center;"></td>
                                    <td class="seprator">:</td>
                                    <td class="width25imp" style="width:20% !important;">
                                        <!--<div id="lblDefectRejectionRatio" style="width:40px;"></div>-->                                        
                                        <input id="lblDefectRejectionRatio" style="width:140px;float:left;"  type="text" size="22" maxlength="100" disabled />
                                        <div class="waterInfo" style="min-width:15%;">%</div>
                                    </td>
                                </tr>
                              
                            </table>
                        </fieldset>
                    </td>
                </tr>

                <!--<tr>
                    <td colspan="2">
                        <fieldset style="width:100%;">
                            <legend>Task Description</legend>
                            <textarea id="txtNotes" rows="5" cols="125" maxlength="500"></textarea>
                        </fieldset>
                    </td>
                </tr>-->
                <tr>
                    <td colspan="2" align="center">
                        <input type="button" class="GuestClass" id="SubmitTask" value="Submit" onclick="Save();" style="float:none;" />
                        <input type="button" value="Cancel" onclick="Cancel();" style="float:none;" />
                    </td>
                </tr>
            </table>
        </div>
        <div id="pager" class="pager" style="display:none">
            <table border="0">
                <tr>
                    <td valign="middle"><img src="images/first.png" class="first" /></td>
                    <td valign="middle"><img src="images/prev.png" class="prev" /></td>
                    <td valign="middle"><input type="text" id="pagedisplay" size="5" />&nbsp; of <div id="totalPages"></div></td>
                    <td valign="middle"><img src="images/next.png" class="next" /></td>
                    <td valign="middle"><img src="images/last.png" class="last" /></td>
                    <td valign="middle">
                        <select id="pagesize">
                            <option selected="selected" value="10">10</option>
                            <option value="20">20</option>
                            <option value="30">30</option>
                            <option value="40">40</option>
                        </select>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div id="ExportExcel" title="Export to CSV" style="display:none">
        <table cellpadding="5" class="tsoPage">
            <tr>
                <td class="smallTiletd width22imp">
                    Select
                </td>
                <td class="seprator">:</td>
                <td class="field width28imp">
                    <select id="TypeOfExport" name="TypeOfExport" style="width:250px">
                        <option value="TSR"> TSR</option>
                        <option value="TSO"> TSO</option>
                        <option value="Tasks"> Tasks</option>
                    </select>
                </td>
            </tr>
            <!-- <tr>
                <td class="smallTiletd width28imp">
                    Select from date
                </td>
                <td class="seprator">:</td>
                <td class="field width28imp">
                    <input id="newADUserID" type="text" size="29" autofocus />
                </td>
            </tr>-->
        </table>
    </div>

    <script type="text/javascript" src="/scripts/tasks.js"></script>
    <script type="text/javascript">
        var startingRecordNumber = 0;
        var pageSize = 500;
        $(".scrollDiv").scroll(function () {
            $("#txtStartDate").datepicker("hide");
            $("#txtTargetCompletionDate").datepicker("hide");
            //$("#txtActualCompletionDate").datepicker("hide");
            //$("#txtActualStartDate").datepicker("hide");
            $("#txtEffortsEnteredUntil").datepicker("hide");
        });

        $(document).ready(function () {
            try {
                var myDate = new Date();
                var currentweek = myDate.getWeek();
                $("#txtEffortsEnteredUntil").val(currentweek);
                CheckUser();
                LoadTaskStatus();
                $('#txtPercentageComplete').focus();
                if (null != tsoId)
                    LoadTSO(tsoId);

                if (null != serviceDeliveryChainId) {
                    LoadServiceDeliveryChain();

                    if (serviceDeliveryChainId == 1) {
                        $("#actualA").show();
                        $("#plannedA").show();
                        $("#actualD").hide();
                        $("#plannedD").hide();
                        $("#actualI").hide();
                        $("#plannedI").hide();
                        $("#actualE").hide();
                        $("#plannedE").hide();
                    }
                    else if (serviceDeliveryChainId == 2) {
                        // $("#actualA").hide();
                        $("#actualA").show();
                        $("#plannedA").show();
                        $("#actualD").show();
                        $("#plannedD").show();
                        $("#actualI").hide();
                        $("#plannedI").hide();
                        $("#actualE").hide();
                        $("#plannedE").hide();
                    }
                    else if (serviceDeliveryChainId == 3) {
                        //$("#actualA").hide();
                        $("#actualA").show();
                        $("#plannedA").show();
                        $("#actualD").hide();
                        $("#plannedD").hide();
                        $("#actualI").show();
                        $("#plannedI").show();
                        $("#actualE").hide();
                        $("#plannedE").hide();
                    }
                    else if (serviceDeliveryChainId == 4) {
                        //$("#actualA").hide();
                        $("#actualA").show();
                        $("#plannedA").show();
                        $("#actualD").hide();
                        $("#plannedD").hide();
                        $("#actualI").hide();
                        $("#plannedI").hide();
                        $("#actualE").show();
                        $("#plannedE").show();
                    }
                    LoadServiceDeliveryChainMethod(serviceDeliveryChainId);
                }

                if (null != tsoServiceDeliveryChainId) {
                    LoadLastTSOServiceDeliveryChainTask();
                }

                $("#txtTSOServiceDeliveryChainId").val(tsoServiceDeliveryChainId);

                $("#txtStartDate").datepicker({
                    dateFormat: 'dd-M-yy', showButtonPanel: true, changeMonth: true, changeYear: true, buttonImage: "/images/calendar.gif", buttonImageOnly: true, inline: true
                });
                $("#txtTargetCompletionDate").datepicker({
                    dateFormat: 'dd-M-yy', showButtonPanel: true, changeMonth: true, changeYear: true, buttonImage: "/images/calendar.gif", buttonImageOnly: true, inline: true
                });

                $("#txtEffortsEnteredUntil").attr("disabled", "disabled");
                //$("#txtActualStartDate").datepicker({
                //    dateFormat: 'dd-M-yy', showButtonPanel: true, changeMonth: true, changeYear: true, buttonImage: "/images/calendar.gif", buttonImageOnly: true, inline: true
                //});
                //$("#txtActualCompletionDate").datepicker({
                //    dateFormat: 'dd-M-yy', showButtonPanel: true, changeMonth: true, changeYear: true, buttonImage: "/images/calendar.gif", buttonImageOnly: true, inline: true
                //});
                //$("#txtEffortsEnteredUntil").datepicker({
                //    showButtonPanel: true, changeMonth: true, changeYear: true, firstDay: 1,
                //    buttonImage: "/images/calendar.gif", buttonImageOnly: true, inline: true, showWeek: true, weekHeader: "W",
                //    onSelect: function (dateText, inst) {
                        
                //        var myDate = new Date();
                //        var currentweek = myDate.getWeek();
                //        var selectedWeek = $.datepicker.iso8601Week(new Date(dateText));
                //        $(this).val(selectedWeek);
                //        //if (selectedWeek > currentweek) {
                //        //    showMessageBox("You can not select the future week !", "red");
                //        //    $(this).val(currentweek);
                //        //    $("#foractualweek").text("for week " + currentweek);
                //        //    $("#forplannedweek").text("for week " + (parseInt(currentweek) + 1));
                //        //}
                //        //else {
                //        //    $(this).val(selectedWeek);
                //        //    $("#foractualweek").text("for week " + selectedWeek);
                //        //    $("#forplannedweek").text("for week " + (parseInt(selectedWeek) + 1));

                //        //    var url = urlPrefix + "TSO/GetTaskByWeek/" + tsoServiceDeliveryChainId + "/" + selectedWeek;
                //        //    if (selectedWeek == currentweek) {
                //        //        $("#SubmitTask").prop("disabled", false);
                //        //        $("#actualProductivity").prop("disabled", false);
                //        //        $("#plannedProductivity").prop("disabled", false);
                //        //        togglePlannedActualselection(false);
                //        //    }
                //        //    else {
                //        //        $("#SubmitTask").prop("disabled", true);
                //        //        $("#actualProductivity").prop("disabled", true);
                //        //        $("#plannedProductivity").prop("disabled", true);
                //        //        togglePlannedActualselection(true);
                //        //        if (oldTask != null && oldTask != "") {
                //        //            if (checkWithOld()) {
                //        //                $(this).val(currentweek);
                //        //                showMessageBox("You have change the data, please save it first and then change the week !", "red");
                //        //                $("#foractualweek").text("for week " + currentweek);
                //        //                $("#forplannedweek").text("for week " + (parseInt(currentweek) + 1));
                //        //                return false;
                //        //            }
                //        //        }
                //        //    }

                //        //    $.ajax({
                //        //        type: "GET",
                //        //        beforeSend: function (request) {
                //        //            request.setRequestHeader('userid', userId);
                //        //        },
                //        //        url: url,
                //        //        dataType: "json",
                //        //        success: function (result) {
                //        //            if (null != result && result.ServiceDeliveryChainId > 0) {
                //        //                PopulateTask(result);
                //        //            }
                //        //            else if (selectedWeek < currentweek) {
                //        //                //ActualReset();
                //        //                //PlannedReset();
                //        //                showMessageBox("Record not found for this week !", "red");
                //        //                $("#txtEffortsEnteredUntil").val(currentweek);
                //        //                $("#foractualweek").text("for week " + currentweek);
                //        //                $("#forplannedweek").text("for week " + (parseInt(currentweek) + 1));
                //        //            }
                //        //        },
                //        //        error: function (jqXHR, textStatus, errorThrown) {
                //        //            // showMessageBox(jqXHR.responseText + "--" + textStatus + "--" + errorThrown, "red");
                //        //            if (errorThrown == "Unauthorized") {
                //        //                textStatus = "You are not authorized to do the current operation."
                //        //            }
                //        //            showMessageBox(textStatus, "red");
                //        //        }
                //        //    });
                //        //}

                //    }
                //});

                $("#lblUser").text(userName);
                if (roleId == "Guest" || roleId == "guest")
                    $(".GuestClass").hide();
                else if (roleId.toLowerCase() == "account manager") {
                    $("#trNewTSR").hide();
                }
                else {
                    $(".GuestClass").show();
                    $("#trNewTSR").show();
                }
                if (roleId == "Admin" || roleId == "admin") {
                    $(".AdminClass").removeAttr('style');
                }

            }
            catch (e) {
                showMessageBox(e, "red");
            }
        });

        function ExportExcelDump() {
            $("#ExportExcel").dialog({
                dialogClass: "no-close block",
                width: "500px",
                hight: "250px",
                modal: true,
                open: $.proxy(function () {
                    $(".ui-dialog-titlebar-close").remove();
                    $(".ui-dialog-titlebar").css("width", "93%");
                    $(".ui-dialog-buttonpane").css("width", "86%");
                    $(".ui-widget-overlay").css("opacity", "1");
                }),
                buttons: [
                        {
                            text: "Export to csv",
                            click: function () {
                                var url;
                                showLoader();
                                var elt = document.getElementById("TypeOfExport");
                                var today = new Date();
                                var todaysdate = today.getDate() + '-' + (today.getMonth() + 1) + '-' + today.getFullYear();
                                if (elt.value === "TSR") {
                                    var url = urlPrefix + "TSR/GetTSRDump/";
                                    $.ajax({
                                        method: 'GET',
                                        url: url,
                                        responseType: 'json',
                                        success: function (result) {
                                            var filename = "iMS TSR Dashboard India " + todaysdate + ".csv";
                                            var contentType = "application/octet-stream";
                                            try {
                                                var blob = new Blob([result], { type: contentType });
                                                //Check if user is using IE
                                                var ua = window.navigator.userAgent;
                                                var msie = ua.indexOf("MSIE ");

                                                if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                                                    window.navigator.msSaveBlob(blob, filename);
                                                    //alert('Please click on save to save the file');
                                                }
                                                else  // If another browser, return 0
                                                {
                                                    //Create a url to the blob
                                                    var url = window.URL.createObjectURL(blob);
                                                    var linkElement = document.createElement('a');
                                                    linkElement.setAttribute('href', url);
                                                    linkElement.setAttribute("download", filename);

                                                    //Force a download
                                                    var clickEvent = new MouseEvent("click", {
                                                        "view": window,
                                                        "bubbles": true,
                                                        "cancelable": false
                                                    });
                                                    linkElement.dispatchEvent(clickEvent);
                                                }
                                            } catch (ex) {
                                                console.log(ex);
                                            }
                                            $(".ui-dialog-content").dialog('destroy');
                                        },
                                        error: function (jqXHR, textStatus, errorThrown) {
                                            hideLoader();
                                            if (jqXHR != null && jqXHR.responseJSON != null && jqXHR.responseJSON.message != "" && jqXHR.responseJSON.message == "The request date is incorrect - check your system clock.") {
                                                showMessageBox("Session timed out.\nRedirecting to login page...", "red", "Index.html", false);
                                            }
                                            else {
                                                showMessageBox(jqXHR.responseText + "--" + textStatus + "--" + errorThrown, "red");
                                            }
                                        }
                                    });
                                }
                                else if (elt.value === "TSO") {
                                    url = urlPrefix + "TSO/GetTSODump/";
                                    $.ajax({
                                        method: 'GET',
                                        url: url,
                                        responseType: 'json',
                                        success: function (result) {
                                            var filename = "iMS TSO Dashboard India " + todaysdate + ".csv";
                                            var contentType = "application/octet-stream";
                                            try {
                                                var blob = new Blob([result], { type: contentType });
                                                //Check if user is using IE
                                                var ua = window.navigator.userAgent;
                                                var msie = ua.indexOf("MSIE ");

                                                if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                                                    window.navigator.msSaveBlob(blob, filename);
                                                    //alert('Please click on save to save the file');
                                                }
                                                else  // If another browser, return 0
                                                {
                                                    //Create a url to the blob
                                                    var url = window.URL.createObjectURL(blob);
                                                    var linkElement = document.createElement('a');
                                                    linkElement.setAttribute('href', url);
                                                    linkElement.setAttribute("download", filename);

                                                    //Force a download
                                                    var clickEvent = new MouseEvent("click", {
                                                        "view": window,
                                                        "bubbles": true,
                                                        "cancelable": false
                                                    });
                                                    linkElement.dispatchEvent(clickEvent);
                                                }
                                            } catch (ex) {
                                                console.log(ex);
                                            }
                                            $(".ui-dialog-content").dialog('destroy');
                                        },
                                        error: function (jqXHR, textStatus, errorThrown) {
                                            hideLoader();
                                            if (jqXHR != null && jqXHR.responseJSON != null && jqXHR.responseJSON.message != "" && jqXHR.responseJSON.message == "The request date is incorrect - check your system clock.") {
                                                showMessageBox("Session timed out.\nRedirecting to login page...", "red", "Index.html", false);
                                            }
                                            else {
                                                showMessageBox(jqXHR.responseText + "--" + textStatus + "--" + errorThrown, "red");
                                            }
                                        }
                                    });
                                }
                                else if (elt.value === "Tasks") {
                                    var txtStartDate = $('#txtStartDate').val()
                                    var txtEndDate = $('#txtEndDate').val()
                                    url = urlPrefix + "TSO/GetServiceDeliveryChainTasks/";
                                    tdata = { startDate: txtStartDate, endDate: txtEndDate };
                                    $.ajax({
                                        method: 'GET',
                                        url: url,
                                        responseType: 'json',
                                        data: tdata,
                                        success: function (result) {
                                            var filename = "iMS TASK Dashboard India " + todaysdate + ".csv";
                                            var contentType = "application/octet-stream";
                                            try {
                                                var blob = new Blob([result], { type: contentType });
                                                //Check if user is using IE
                                                var ua = window.navigator.userAgent;
                                                var msie = ua.indexOf("MSIE ");

                                                if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                                                    window.navigator.msSaveBlob(blob, filename);
                                                    //alert('Please click on save to save the file');
                                                }
                                                else  // If another browser, return 0
                                                {
                                                    //Create a url to the blob
                                                    var url = window.URL.createObjectURL(blob);
                                                    var linkElement = document.createElement('a');
                                                    linkElement.setAttribute('href', url);
                                                    linkElement.setAttribute("download", filename);

                                                    //Force a download
                                                    var clickEvent = new MouseEvent("click", {
                                                        "view": window,
                                                        "bubbles": true,
                                                        "cancelable": false
                                                    });
                                                    linkElement.dispatchEvent(clickEvent);
                                                }
                                            } catch (ex) {
                                                console.log(ex);
                                            }
                                            $(".ui-dialog-content").dialog('destroy');
                                        },
                                        error: function (jqXHR, textStatus, errorThrown) {
                                            hideLoader();
                                            if (jqXHR != null && jqXHR.responseJSON != null && jqXHR.responseJSON.message != "" && jqXHR.responseJSON.message == "The request date is incorrect - check your system clock.") {
                                                showMessageBox("Session timed out.\nRedirecting to login page...", "red", "Index.html", false);
                                            }
                                            else {
                                                showMessageBox(jqXHR.responseText + "--" + textStatus + "--" + errorThrown, "red");
                                            }
                                        }
                                    });
                                }
                            }
                        },
                        {
                            text: "Cancel",
                            click: function () {
                                $(this).dialog("close");
                            }
                        }

                ]
            });
        }

    </script>

</body>
</html>
